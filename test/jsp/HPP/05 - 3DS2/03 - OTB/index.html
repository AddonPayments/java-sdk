<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Víctor Cantera">
        <link rel="icon" href="../../../../assets/img/comercia_ico.png" type="image/x-icon"/ >
        <title>OTB con 3DS2 (HPP) - SDK JAVA</title>

        <!-- Bootstrap 4.3.1 -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

        <!-- CSS -->
        <link rel="stylesheet" href="../../../../assets/css/style.css">

        <!-- Script para comprobar los datos de la tarjeta mediante HPP -->
        <script src="../../../../assets/js/rxp-hpp.js"></script> <!-- Available at https://github.com/realexpayments -->
    </head>

    <body>
      <!-- NAVBAR -->
        <nav class="navbar navbar-expand-lg navbar-light navbar-rpdc mb-3">
            <a class="navbar-brand">
                <img src="../../../../assets/img/log2.svg" width="30" height="30" class="img-fluid" alt="Logo Addon Payments">
                <span class="addonNav">ADDON</span> <span>PAYMENTS</span>
                <span class="d-none d-sm-none d-lg-inline d-xl-inline sdkNav">
                    <span>
                        /SDK
                        <span class="barraNav">_</span>
                        de
                        <span class="barraNav">_</span>
                        JAVA
                    </span>
                </span>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
          </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto pl-2 pr-2">
                    <li class="nav-item dropdown">
                        <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Inicio
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item pl-2" href="../../../../index.html">Índice</a>
                            <a class="dropdown-item pl-2" href="../../../errores.html">Errores de Addon Payments</a>
                            <a class="dropdown-item pl-2" href="../../../informe.html">Convertir informe</a>
                        </div>
                    </li>
                    <li class="nav-item ml-1 dropdown">
                        <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Pagos con tarjeta
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <div class="dropdown-header text-center p-0">API</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2" href="../../../API/01%20-%20Pagos%20con%20tarjeta/01%20-%20Autorización/index.html">Autorización</a>
                                <a class="dropdown-item pl-2" href="../../../API/01%20-%20Pagos%20con%20tarjeta/02%20-%20OTB/index.html">OTB</a>
                                <a class="dropdown-item pl-2" href="../../../API/01%20-%20Pagos%20con%20tarjeta/03%20-%20Credit/index.html">Credit</a>
                            <hr class="m-0 p-0">
                            <div class="dropdown-header text-center p-0">HPP</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2" href="../../01%20-%20Pagos%20con%20tarjeta/01%20-%20Autorizacion/index.html">Autorización</a>
                                <a class="dropdown-item pl-2" href="../../01%20-%20Pagos%20con%20tarjeta/02%20-%20OTB/index.html">OTB</a>
                                <a class="dropdown-item pl-2" href="../../01%20-%20Pagos%20con%20tarjeta/03%20-%20Pay%20By%20Link/index.html">Pay By Link</a>
                        </div>
                    </li>
                    <li class="nav-item ml-1 dropdown">
                        <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Almacenamiento de tarjeta
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <div class="dropdown-header text-center p-0">API</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2" href="../../../API/02%20-%20Almacenamiento%20de%20tarjeta/01%20-%20Crear%20un%20cliente/index.html">Crear un cliente</a>
                                <a class="dropdown-item pl-2" href="../../../API/02%20-%20Almacenamiento%20de%20tarjeta/02%20-%20Almacenar%20una%20tarjeta/index.html">Almacenar una tarjeta</a>
                                <a class="dropdown-item pl-2" href="../../../API/02%20-%20Almacenamiento%20de%20tarjeta/03%20-%20Editar%20tarjeta/index.html">Editar tarjetas</a>
                                <a class="dropdown-item pl-2" href="../../../API/02%20-%20Almacenamiento%20de%20tarjeta/04%20-%20Eliminar%20tarjeta/index.html">Eliminar tarjetas</a>
                                <a class="dropdown-item pl-2" href="../../../API/02%20-%20Almacenamiento%20de%20tarjeta/05%20-%20Auth/index.html">Autorización</a>
                                <a class="dropdown-item pl-2" href="../../../API/02%20-%20Almacenamiento%20de%20tarjeta/06%20-%20Credit/index.html">Credit</a>
                            <hr class="m-0 p-0">
                            <div class="dropdown-header text-center p-0">3DS2</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2" href="../../../API/06%20-%203DS2/02%20-%20Card%20Storage/index.html">Comprobar versión</a>
                                <a class="dropdown-item pl-2" href="../../../API/06%20-%203DS2/02%20-%20Card%20Storage/index.html#authenticationTitle">Autenticación</a>
                                <a class="dropdown-item pl-2" href="../../../API/06%20-%203DS2/02%20-%20Card%20Storage/index.html#authorizationTitle">Autorización</a>
                            <hr class="m-0 p-0">
                            <div class="dropdown-header text-center p-0">HPP</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2" href="../../02%20-%20Almacenamiento%20de%20tarjeta/01%20-%20Crear%20un%20cliente/index.html">Crear un cliente</a>
                                <a class="dropdown-item pl-2" href="../../02%20-%20Almacenamiento%20de%20tarjeta/02%20-%20Mostrar%20Tarjetas/index.html">Mostrar tarjetas</a>
                        </div>
                    </li>

                    <li class="nav-item ml-1 dropdown">
                        <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Gestión de transacciones
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item pl-2" href="../../../API/03%20-%20Gestión%20de%20transacciones/01%20-%20Capturar/index.html">Settle (Capturar)</a>
                            <a class="dropdown-item pl-2" href="../../../API/03%20-%20Gestión%20de%20transacciones/02%20-%20Rebate/index.html">Rebate (Devolución)</a>
                            <a class="dropdown-item pl-2" href="../../../API/03%20-%20Gestión%20de%20transacciones/03%20-%20Void/index.html">Void (Anular transacción)</a>
                        </div>
                    </li>

                    <li class="nav-item ml-1 dropdown">
                        <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Filtro de fraude
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            
                            <div class="dropdown-header text-center p-0">API</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2"  href="../../../API/05%20-%20Fraud%20Management/01%20-%20Fraud%20Filter/index.html">Filtro de fraude</a>
                                <a class="dropdown-item pl-2"  href="../../../API/05%20-%20Fraud%20Management/02%20-%20Address%20Verification">Verificación de dirección</a>
                                <a class="dropdown-item pl-2"  href="../../../API/05%20-%20Fraud%20Management/03%20-%20Hold">Retener transacción</a>
                                <a class="dropdown-item pl-2"  href="../../../API/05%20-%20Fraud%20Management/04%20-%20Lanzamiento">Lanzar transacción</a>
                            <hr class="m-0 p-0">
                            <div class="dropdown-header text-center p-0">HPP</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2"  href="../../03%20-%20Fraud%20Management/01%20-%20Fraud%20Filter/index.html">Filtro de fraude</a>
                        </div>
                    </li>

                    <li class="nav-item ml-1 dropdown">
                        <a class="nav-link pl-2 dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            DCC
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <div class="dropdown-header text-center p-0">API</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2"  href="../../../API/04%20-%20DCC/01%20-%20Comprobar%20DCC/index.html">Comprobar DCC</a>
                            <hr class="m-0 p-0">
                            <div class="dropdown-header text-center p-0">HPP</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2"href="../../04%20-%20DCC/index.html">Operación con DCC</a>
                        </div>
                    </li>
                    <li class="nav-item ml-1 dropdown">
                        <a class="nav-link pl-2 dropdown-toggle active" href="#" id="06-3DS2" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            3DS2
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                            <div class="dropdown-header text-center p-0">API</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2" href="../../../API/06%20-%203DS2/01%20-%20Autorización/index.html">Autorización</a>
                            <hr class="m-0 p-0">
                            <div class="dropdown-header text-center p-0">HPP</div>
                            <hr class="m-0 p-0">
                                <a class="dropdown-item pl-2" href="../01%20-%20Autorización/index.html">Autorización</a>
                                <a class="dropdown-item pl-2" href="../02%20-%20Datos%20adicionales/index.html">Datos adicionales</a>
                                <a class="dropdown-item pl-2 active" href="#">OTB con 3DS2</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- /NAVBAR -->

      <div class="col-lg-12"> 
        <div id="contenidoComun" class="container-fluid">
          <div class="row">

            <!-- Menú lateral -->
            <div class="col-lg-2 sticky-top d-none d-sm-none d-lg-block d-xl-block MenuLateral">

              <!-- Barra de progreso -->
              <div class="progress-bar" id="progreso"></div>
              <!-- /Barra de progreso -->

                <nav class="navbar sticky-top navbar-light" style="padding: 0px;">
                    <nav class="nav nav-pills flex-column">
                        <a class="nav-link" href="#otb">1. OTB</a>
                        <nav class="nav nav-pills flex-column">
                            <a class="nav-link ml-3 my-1" href="#codigoEjemplo">1.1 Código de ejemplo</a>
                        </nav>
                        <a class="nav-link" href="#descripciones">2. Descripciones</a>
                        <nav class="nav nav-pills flex-column">
                            <a class="nav-link ml-3 my-1" id="#imports" href="#imports">2.1 Imports</a>
                            <a class="nav-link ml-3 my-1" id="#ConfigTerminal" href="#ConfigTerminal">2.2 Configuración del terminal</a>
                            <a class="nav-link ml-3 my-1" id="#camposObligatorios" href="#camposObligatorios">2.3 Campos obligatorios</a>
                            <a class="nav-link ml-3 my-1" id="#envioOP" href="#envioOP">2.4 Envío de la operación archivo JAVA</a>
                            <a class="nav-link ml-3 my-1" id="#envioOPHTML" href="#envioOPHTML">2.5 Envío de la operación archivo HTML</a>
                        </nav>
                        <a class="nav-link" href="#authFlujos">3. Flujos de autenticación</a>
                        <nav>
                            <a class="nav-link ml-3 my-1" href="#flujoSinFric">3.1 Flujo sin fricción</a>
                            <a class="nav-link ml-3 my-1" href="#flujoConFric">3.2 Flujo con fricción</a>
                            <a class="nav-link ml-3 my-1" href="#simulador">3.3 Simulador ACS</a>
                            <a class="nav-link ml-3 my-1" href="#resultadoDesafio">3.4 Resultado del desafío</a>
                        </nav>
                    </nav>
                </nav>
            </div>

            <div class="col-lg-10" >
                <!-- Punto 1 -->
                <div class="contenedor">
                  <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                      <h3 id="otb" class="titulo">
                          1. OTB
                      </h3>
                      <hr>

                      <p>
                         Open To Buy (OTB) permite verificar que una tarjeta sigue siendo válida y activa sin procesar realmente un pago contra ella. Las comprobaciones del código de seguridad (CVN) y AVS también se realizarán en su contra. Esta es una alternativa a cargar a la tarjeta una pequeña cantidad (por ejemplo 10 céntimos) para obtener el mismo resultado.
                      </p>
                      <p class="alert alert-danger" role="alert">
                          Recomendamos encarecidamente sanear los datos del titular de la tarjeta antes de enviarla en la solicitud. Por ejemplo, debe comprobar que el número de tarjeta es válido y que la fecha de caducidad es correcta. <a target="_blank" href="https://github.com/globalpayments/rxp-js">Nuestra biblioteca JS</a> contiene un conjunto de funciones útiles que le ayudan a procesar las solicitudes correctamente.
                          <small class="form-text text-muted">
                              --> En los ejemplos de esta documentación usamos el fichero de comprobación JS rxp-hpp.js de RealexPayments.  Podrá ver el fichero en la carpeta de "assets/js".
                          </small>
                      </p>

                      <h5 style="" class="pt-3" id="codigoEjemplo">
                          1.1 Código de ejemplo
                      </h5>
                      
                      <hr>

                      <!-- Código ejemplo-->
                      <div class="p-4 panelCode">
                          <code>
                                <span class="comments">// Importamos las clases necesarias para realizar las peticiones</span>
                            <br>
                                <span class="purple">import </span><span class="variables">java.math.BigDecimal</span><span class="new">;</span>
                            <br>
                            <br>
                                <span class="purple">import </span><span class="variables">org.junit.Test</span><span class="new">;</span>
                            <br>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.ServicesContainer</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.Address</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.HostedPaymentData</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.enums.AddressType</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.enums.HppVersion</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.exceptions.ApiException</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.serviceConfigs.HostedPaymentConfig</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.services.HostedService</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.serviceConfigs.GatewayConfig</span><span class="new">;</span>
                            <br>
                            <br>
                                <span class="comments">// Configuramos el cliente y los ajustes de la petición</span>
                            <br>
                                <span class="variables">GatewayConfig </span><span class="orange">config </span><span class="new">= new </span><span class="variables">GatewayConfig();</span>
                            <br>
                                <span class="orange">config.</span><span class="variables">setMerchantId(</span><span class="new">"addonjavatest"</span><span class="variables">);</span>
                            <br>
                                <span class="orange">config.</span><span class="variables">setAccountId(</span><span class="new">"3ds2"</span><span class="variables">);</span>
                            <br>
                                <span class="orange">config.</span><span class="variables">setSharedSecret(</span><span class="new">"secret"</span><span class="variables">);</span>
                            <br>
                                <span class="orange">config.</span><span class="variables">setServiceUrl(</span><span class="new">"https://hpp.sandbox.addonpayments.com/pay"</span><span class="variables">);</span>
                            <br>
                            <br>
                                <span class="comments">// Creamos el objeto de "hostedPaymentConfig"</span>
                            <br>
                                <span class="variables">HostedPaymentConfig </span><span class="orange">hostedPaymentConfig </span><span class="variables">= </span><span class="purple">new </span><span class="variables">HostedPaymentConfig();</span>
                            <br>
                                <span class="new">hostedPaymentConfig</span><span class="variables">.setVersion(HppVersion.</span><span class="new">Version2</span><span class="variables">);</span>
                            <br>
                                <span class="orange">config</span><span class="variables">.setHostedPaymentConfig(</span><span class="new">hostedPaymentConfig</span><span class="variables">);</span>
                            <br>
                            <br>
                                <span class="comments">// Añadimos los campos obligatorios y recomendados por 3D Secure 2</span>
                            <br>
                            <span class="variables">HostedPaymentData </span><span class="new">hostedPaymentData </span><span class="variables">= </span><span class="purple">new </span><span class="variables">HostedPaymentData();</span>
                            <br>
                                <span class="new">hostedPaymentData</span><span class="variables">.setCustomerEmail(</span><span class="new">"soporte@addonpayments.com"</span><span class="variables">);</span>
                            <br>
                                <span class="new">hostedPaymentData</span><span class="variables">.setCustomerPhoneMobile(</span><span class="new">"34|914353028"</span><span class="variables">);</span>
                            <br>
                                <span class="new">hostedPaymentData</span><span class="variables">.setAddressesMatch(</span><span class="purple">false</span><span class="variables">);</span>
                            <br>
                            <br>
                                <span class="variables">Address </span><span class="new">billingAddress </span><span class="variables">= </span><span class="purple">new </span><span class="variables">Address();</span>
                            <br>
                                <span class="new">billingAddress</span><span class="variables">.setStreetAddress1(</span><span class="new">"Calle 123"</span><span class="variables">);</span>
                            <br>
                                <span class="new">billingAddress</span><span class="variables">.setStreetAddress2(</span><span class="new">"Calle 456"</span><span class="variables">);</span>
                            <br>
                                <span class="new">billingAddress</span><span class="variables">.setStreetAddress3(</span><span class="new">"Calle 789"</span><span class="variables">);</span>
                            <br>
                                <span class="new">billingAddress</span><span class="variables">.setCity(</span><span class="new">"Elche"</span><span class="variables">);</span>
                            <br>
                                <span class="new">billingAddress</span><span class="variables">.setPostalCode(</span><span class="new">"03201"</span><span class="variables">);</span>
                            <br>
                                <span class="new">billingAddress</span><span class="variables">.setCountry(</span><span class="new">"826"</span><span class="variables">);</span>
                            <br>
                            <br>
                                <span class="variables">Address </span><span class="new">shippingAddress  </span><span class="variables">= </span><span class="purple">new </span><span class="variables">Address();</span>
                            <br>
                                <span class="new">shippingAddress </span><span class="variables">.setStreetAddress1(</span><span class="new">"Calle 123"</span><span class="variables">);</span>
                            <br>
                                <span class="new">shippingAddress </span><span class="variables">.setStreetAddress2(</span><span class="new">"Calle 456"</span><span class="variables">);</span>
                            <br>
                                <span class="new">shippingAddress </span><span class="variables">.setStreetAddress3(</span><span class="new">"Calle 789"</span><span class="variables">);</span>
                            <br>
                                <span class="new">shippingAddress </span><span class="variables">.setCity(</span><span class="new">"Elche"</span><span class="variables">);</span>
                            <br>
                                <span class="new">shippingAddress </span><span class="variables">.setPostalCode(</span><span class="new">"03201"</span><span class="variables">);</span>
                            <br>
                                <span class="new">shippingAddress </span><span class="variables">.setState(</span><span class="new">"ES"</span><span class="variables">);</span>
                            <br>
                                <span class="new">shippingAddress </span><span class="variables">.setCountry(</span><span class="new">"826"</span><span class="variables">);</span>
                            <br>
                            <br>
                                <span class="variables">HostedService </span><span class="new">service  </span><span class="variables">= </span><span class="purple">new </span><span class="variables">HostedService(</span><span class="orange">config</span><span class="variables">);</span>
                            <br>
                            <br>
                                <span class="comments">// Lanzamos la petición al servidor de Addon Payments</span>
                            <br>
                                <span class="purple">try </span><span class="variables">{</span>
                            <br>
                                <span class="pl-3 comments">// Procesamos una autorización</span>
                            <br>
                                <span class="pl-3 variables">String </span><span class="new">hppJson </span><span class="variables">= </span><span class="new">service</span><span class="variables">.verify(</span><span class="purple">new </span><span class="variables">BigDecimal(</span><span class="new">"0"</span><span class="variables">))</span>
                            <br>
                                <span class="pl-5 variables">.withCurrency(</span><span class="new">"EUR"</span><span class="variables">)</span>
                            <br>
                                <span class="pl-5 variables">.withHostedPaymentData(</span><span class="new">hostedPaymentData</span><span class="variables">)</span>
                            <br>
                                <span class="pl-5 variables">.withAddress(</span><span class="new">billingAddress</span><span class="variables">, AddressType.</span><span class="new">Billing</span><span class="variables">)</span>
                            <br>
                                <span class="pl-5 variables">.withAddress(</span><span class="new">shippingAddress</span><span class="variables">, AddressType.</span><span class="new">Shipping</span><span class="variables">)</span>
                            <br>
                                <span class="pl-5 variables">.serialize();</span>
                            <br>
                            <br>
                                <span class="pl-3 comments">// TODO: Pasar la petición HPP JSON a la librería de JavaScript, iOS o Android</span>
                            <br>
                            <br>
                                <span class="variables">}</span><span class="purple"> catch</span> <span class="variables">(ApiException exc) {</span>
                            <br>
                                <span class="comments pl-5">// Añada aquí su tratamiento de errores</span>
                            <br>
                                <span class="pl-5 variables">String <span class="orange">errorMessage </span><span class="variables">= </span><span class="orange">exc</span><span class="variables">.getMessage();</span>
                            <br>
                                <span class="variables">}</span>
                          </code>
                      </div>
                      <!-- Fin código ejemplo-->
                    </div>            
                  </div>
                  <!-- Fin punto 1 -->

                  <!-- Punto 2 -->
                  <div class="contenedor">
                    <div class="pl-3 pt-3 mb-4 pb-1 pr-3 text-justify">
                      <h3 class="pt-1" id="descripciones">
                        2. Descripciones
                      </h3>
                        <hr>
                         
                        <h5 id="imports">2.1 Imports</h5>
                        <p>
                          Debemos cargar el archivo que enruta las clases del SDK e importar aquellas clases encesarias para realizar una operación:
                        </p>
                      <div class="p-4 mb-4 panelCode">
                        <code>
                                <span class="purple">import </span><span class="variables">java.math.BigDecimal</span><span class="new">;</span>
                            <br>
                            <br>
                                <span class="purple">import </span><span class="variables">org.junit.Test</span><span class="new">;</span>
                            <br>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.ServicesContainer</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.Address</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.HostedPaymentData</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.enums.AddressType</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.enums.HppVersion</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.entities.exceptions.ApiException</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.serviceConfigs.HostedPaymentConfig</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.services.HostedService</span><span class="new">;</span>
                            <br>
                                <span class="purple">import </span><span class="variables">com.global.api.serviceConfigs.GatewayConfig</span><span class="new">;</span>
                        </code>
                      </div>

                      <hr>

                      <h5 id="ConfigTerminal" class="mt-3">
                          2.2 Configuración del terminal
                      </h5>

                        <p>
                           Debemos introducir los datos de configuración que se facilitan en la llamada de cualificación del soporte técnico de Addon Payments.
                        </p>

                        <ul>
                           <li>
                               Merchant_ID = Identificador del comercio.
                           </li>
                           <li>
                               SubAccount = Subcuenta faciltiada en la llamada de cualificación (en caso de que se envíe la operación sin subcuenta, se usará la establecida por defecto en la creación de su terminal).
                           </li>
                           <li>
                               Shared Secret = Contraseña de seguridad del terminal.
                           </li>
                        </ul>
                        <small class="form-text text-muted alert alert-primary">
                            --&gt; En caso de que le falte algún dato de los mencionados arriba, debe contactar con su soporte técnico de Addon Payments llamando al teléfono 914 353 028 (opción 2) o enviando un email al correo electrónico <a target="_blank" href="mailto:soporteaddonpayments.com">soporteaddonpayments.com</a>.
                        </small>
                        <div class="p-4 mb-4 panelCode">
                          <code>
                                <span class="comments">// Configuramos el cliente y los ajustes de la petición</span>
                            <br>
                                <span class="variables">GatewayConfig </span><span class="orange">config </span><span class="new">= new </span><span class="variables">GatewayConfig();</span>
                            <br>
                                <span class="orange">config.</span><span class="variables">setMerchantId(</span><span class="new">"addonjavatest"</span><span class="variables">);</span>
                            <br>
                                <span class="orange">config.</span><span class="variables">setAccountId(</span><span class="new">"3ds2"</span><span class="variables">);</span>
                            <br>
                                <span class="orange">config.</span><span class="variables">setSharedSecret(</span><span class="new">"secret"</span><span class="variables">);</span>
                            <br>
                                <span class="orange">config.</span><span class="variables">setServiceUrl(</span><span class="new">"https://hpp.sandbox.addonpayments.com/pay"</span><span class="variables">);</span>
                            <br>
                            <br>
                                <span class="comments">// Creamos el objeto de "hostedPaymentConfig"</span>
                            <br>
                                <span class="variables">HostedPaymentConfig </span><span class="orange">hostedPaymentConfig </span><span class="variables">= </span><span class="purple">new </span><span class="variables">HostedPaymentConfig();</span>
                            <br>
                                <span class="new">hostedPaymentConfig</span><span class="variables">.setVersion(HppVersion.</span><span class="new">Version2</span><span class="variables">);</span>
                            <br>
                                <span class="orange">config</span><span class="variables">.setHostedPaymentConfig(</span><span class="new">hostedPaymentConfig</span><span class="variables">);</span>
                          </code>
                        </div>

                        <hr>

                        <h5 id="camposObligatorios" class="mt-3">
                            2.3 Campos obligatorios
                        </h5>

                        <p>
                            Debemos enviar la información recopilada del cliente:
                            <ul>
                                <li>Email</li>
                                <li>Teléfono</li>
                                <li>Indicar a "True" si la dirección de facturación y envío es la misma</li>
                                <li>Dirección de facturación y envío del cliente</li>
                            </ul>
                        </p>

                        <div class="p-4 mb-4 panelCode">
                            <code>
                                    <span class="comments">// Añadimos los campos obligatorios y recomendados por 3D Secure 2</span>
                                <br>
                                    <span class="variables">HostedPaymentData </span><span class="new">hostedPaymentData </span><span class="variables">= </span><span class="purple">new </span><span class="variables">HostedPaymentData();</span>
                                <br>
                                    <span class="new">hostedPaymentData</span><span class="variables">.setCustomerEmail(</span><span class="new">"soporte@addonpayments.com"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">hostedPaymentData</span><span class="variables">.setCustomerPhoneMobile(</span><span class="new">"34|914353028"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">hostedPaymentData</span><span class="variables">.setAddressesMatch(</span><span class="purple">false</span><span class="variables">);</span>
                                <br>
                                <br>
                                    <span class="variables">Address </span><span class="new">billingAddress </span><span class="variables">= </span><span class="purple">new </span><span class="variables">Address();</span>
                                <br>
                                    <span class="new">billingAddress</span><span class="variables">.setStreetAddress1(</span><span class="new">"Calle 123"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">billingAddress</span><span class="variables">.setStreetAddress2(</span><span class="new">"Calle 456"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">billingAddress</span><span class="variables">.setStreetAddress3(</span><span class="new">"Calle 789"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">billingAddress</span><span class="variables">.setCity(</span><span class="new">"Elche"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">billingAddress</span><span class="variables">.setPostalCode(</span><span class="new">"03201"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">billingAddress</span><span class="variables">.setCountry(</span><span class="new">"826"</span><span class="variables">);</span>
                                <br>
                                <br>
                                    <span class="variables">Address </span><span class="new">shippingAddress  </span><span class="variables">= </span><span class="purple">new </span><span class="variables">Address();</span>
                                <br>
                                    <span class="new">shippingAddress </span><span class="variables">.setStreetAddress1(</span><span class="new">"Calle 123"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">shippingAddress </span><span class="variables">.setStreetAddress2(</span><span class="new">"Calle 456"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">shippingAddress </span><span class="variables">.setStreetAddress3(</span><span class="new">"Calle 789"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">shippingAddress </span><span class="variables">.setCity(</span><span class="new">"Elche"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">shippingAddress </span><span class="variables">.setPostalCode(</span><span class="new">"03201"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">shippingAddress </span><span class="variables">.setState(</span><span class="new">"ES"</span><span class="variables">);</span>
                                <br>
                                    <span class="new">shippingAddress </span><span class="variables">.setCountry(</span><span class="new">"826"</span><span class="variables">);</span>
                            </code>
                        </div>

                        <hr>

                        <h5 id="envioOP" class="mt-3">
                            2.4 Envío de la operación archivo JAVA
                        </h5>

                        <p>
                            Para enviar la operación debemos emplear el modelo de excepciones "try - catch". 
                        </p>
                        <ul>
                            <li>
                                Llamamos al objeto "$hppJson" e indicamos el importe '0' para cumplir OTB en 3DS2: 
                                <br>
                                <span class="arrow"></span><span class="variableBgW">service</span><span class="arrow">.verify(<span class="variableBgW">new</span> BigDecimal(<span class="comentariosBgW">"0"</span>))</span>
                            </li>

                            <br>

                            <li>
                                Posteriormente debemos indicar la moneda en la que vamos a realizar el cargo:
                                <span class="arrow">.withCurrency(</span><span class="comentariosBgW">"EUR"</span><span class="arrow">)</span>
                            </li>
                            
                            <br>

                            <li>
                                Debemos indicar los datos recopilados del cliente:
                                <span class="arrow">.withHostedPaymentData(</span><span class="variableBgW">hostedPaymentData</span><span class="arrow">)</span>
                            </li>

                            <br>

                            <li>
                                Indicamos también la dirección de envío y facturación del cliente:
                                <br>
                                    <span class="arrow">.withAddress(</span><span class="variableBgW">billingAddress, AddressType.Billing</span><span class="arrow">)</span>
                                <br>
                                    <span class="arrow">.withAddress(</span><span class="variableBgW">shippingAddress, AddressType.Shipping</span><span class="arrow">)</span>
                            </li>
                            
                            <br>

                            <li>
                                Por último, enviamos la petición:
                                <span class="arrow">.serialize();</span>
                            </li>
                        </ul>
                        <div class="p-4 mb-4 panelCode">
                          <code>
                              <span class="purple">try </span><span class="variables">{</span>
                            <br>
                                <span class="pl-3 comments">// Procesamos una autorización</span>
                            <br>
                                <span class="pl-3 variables">String </span><span class="new">hppJson </span><span class="variables">= </span><span class="new">service</span><span class="variables">.verify(</span><span class="purple">new </span><span class="variables">BigDecimal(</span><span class="new">"0"</span><span class="variables">))</span>
                            <br>
                                <span class="pl-5 variables">.withCurrency(</span><span class="new">"EUR"</span><span class="variables">)</span>
                            <br>
                                <span class="pl-5 variables">.withHostedPaymentData(</span><span class="new">hostedPaymentData</span><span class="variables">)</span>
                            <br>
                                <span class="pl-5 variables">.withAddress(</span><span class="new">billingAddress</span><span class="variables">, AddressType.</span><span class="new">Billing</span><span class="variables">)</span>
                            <br>
                                <span class="pl-5 variables">.withAddress(</span><span class="new">shippingAddress</span><span class="variables">, AddressType.</span><span class="new">Shipping</span><span class="variables">)</span>
                            <br>
                                <span class="pl-5 variables">.serialize();</span>
                            <br>
                            <br>
                                <span class="pl-3 comments">// TODO: Pasar la petición HPP JSON a la librería de JavaScript, iOS o Android</span>
                            <br>
                            <br>
                                <span class="variables">}</span><span class="purple"> catch</span> <span class="variables">(ApiException exc) {</span>
                            <br>
                                <span class="comments pl-5">// Añada aquí su tratamiento de errores</span>
                            <br>
                                <span class="pl-5 variables">String <span class="orange">errorMessage </span><span class="variables">= </span><span class="orange">exc</span><span class="variables">.getMessage();</span>
                            <br>
                                <span class="variables">}</span>
                          </code>
                        </div>
                        <p>
                            Para la respuesta obtenemos en la variable 'errorMessage' el resultado de la función "<span class="arrow">getMessage()</span>".
                            <br>
                            <br>
                            Con esta función obtenemos el motivo de la denegación del servidor. Para ver todos los errores de denegación actualizados, puede comprobar nuestra <a target="_blank" href="https://desarrolladores.addonpayments.com/#!/technical-resources/messages">documentación de Addon Payments.</a>
                        </p>

                        <hr>

                        <h5 id="envioOPHTML" class="mt-3">
                            2.5 Envío de la operación archivo HTML
                        </h5>

                        <p>
                            Para lanzar la operación desde nuestro HTML, debemos emplear lo siguientes parámetros: 
                        </p>
                        <ul>
                          <li>
                              Indicamos la ruta del archivo jsp que realiza la petición al servidor de html: 
                              <span class="arrow">$.getJSON(</span><span class="comentariosBgW">"request.jsp"</span><span class="arrow">)</span>
                          </li>

                          <br>

                          <li>
                              Posteriormente debemos indicar la URL del servidor de Addon Payments:
                              <span class="arrow">setHppUrl(</span><span class="comentariosBgW">"https://hpp.sandbox.addonpayments.com/pay"</span><span class="arrow">);</span>
                          </li>
                          
                          <br>

                          <li>
                              Por último, debemos indicar el identificador del botón y la ruta del archivo de respuesta:
                              <span class="arrow">redirect.init(</span><span class="comentariosBgW">"payButtonId"</span><span class="arrow">,</span> <span class="comentariosBgW">"response.html"</span><span class="arrow">);</span>
                          </li>
                      </ul>
                      <div class="p-4 mb-4 panelCode">
                        <code>
                                <span class="pl-2 new"><</span><span class="script">script</span><span class="new">></span>
                            <br>
                                <span class="pl-4">$</span><span class="require">(</span><span class="service">document</span><span class="require">).</span><span class="new">ready(</span><span class="function">function</span><span class="new">() {</span>
                            <br>
                                <span class="pl-5">$.</span><span class="new">getJSON(</span><span class="require">"</span><span class="green">request.jsp</span><span class="require">"</span><span class="new">,</span> <span class="function">function</span><span class="require">(</span><span class="orange">jsonFromRequestEndpoint</span><span class="require">) {</span>
                            <br>
                                <span class="pl-5 service">RealexHpp</span><span class="new">.setHppUrl(</span><span class="require">"</span><span class="green">https://hpp.sandbox.addonpayments.com/pay</span><span class="require">"</span><span class="new">);</span>
                            <br>
                                <span class="pl-5 service">RealexHpp</span><span class="new">.redirect.init(</span><span class="require">"</span><span class="green">payButtonId</span><span class="require">"</span><span class="new">,</span> <span class="require">"</span><span class="green">response.html</span><span class="require">"</span><span class="new">,</span> <span class="variables">jsonFromRequestEndpoint</span><span class="new">);</span>
                            <br>
                                <span class="pl-5 new">});</span>
                            <br>
                                <span class="pl-4 new">});</span>
                            <br>
                                <span class="pl-2 new"><</span><span class="script">/script</span><span class="new">></span>
                        </code>
                      </div>
                    </div>            
                  </div>
                  <!-- Fin punto 2 -->

                  <div class="contenedor">
                    <div class="pl-3 pt-3 pr-3 pb-4 mb-3 text-justify">
                        <h3 class="pt-1" id="authFlujos">
                            3. Flujos de autenticación
                        </h3>

                        <hr>
                        
                        <p>
                            En este punto, el Emisor analizará la transacción. Tendrá en cuenta factores como los datos que su aplicación ha proporcionado junto con el comportamiento histórico del cliente y el análisis de transacciones.
                             El resultado de este proceso determinará si el Emisor decide que el cliente debe autenticar aún más la transacción y realizar una comprobación con el ACS (flujo con fricción).
                        </p>

                        <hr>

                        <h5 class="pt-1" id="flujoSinFric">
                            3.1 Flujo sin fricción
                        </h5>
                        
                        <p>
                            En un flujo sin fricciones, el Emisor puede determinar que no se requiere autenticación adicional, que la transacción puede continuar.
                             O en base a la información que ha recibido hasta ahora, que la transacción no debería continuar.
                        </p>

                        <p>
                            En un escenario de transacción bloqueada, Addon Payments devolverá un mensaje de respuesta de falla a su aplicación/sitio web y puede optar por redirigir al cliente a la página de pago mientras le informa del resultado.
                             De lo contrario, el HPP completará el proceso de autenticación y procederá a la autorización, incluidos los datos de autenticación de 3D Secure.
                        </p>
                        
                        <hr>

                        <h5 class="pt-1" id="flujoConFric">
                            3.2 Flujo con fricción
                        </h5>
                        
                        <p>
                            En el caso de un flujo de fricción, el Emisor ha determinado que el cliente debe autenticar aún más la transacción.
                             El HPP mostrará el Emisor ACS al cliente.
                              El desafío puede implicar una serie de pasos, incluido que el cliente ingrese una contraseña de un solo uso enviada a su teléfono o responda algunas preguntas que solo él sabría responder.
                        </p>
                        <p>
                            El Emisor ACS determinará el tipo de desafío que se mostrará al cliente y se alineará con al menos dos elementos de la autenticación sólida del cliente (SCA):
                            <ul>
                                <li><b>Possession:</b> Algo que solo el cliente tiene, por ejemplo, su dispositivo móvil registrado en su banco en el que recibirá un código en un SMS.</li>
                                <li><b>Inherence:</b> Su huella digital u otra forma de datos biométricos.</li>
                                <li><b>Knowledge:</b> Una frase de contraseña única o la respuesta a una pregunta personal.</li>
                            </ul>
                        </p>

                        <hr>

                        <h5 class="pt-1" id="simulador">
                            3.3 Simulador ACS
                        </h5>

                        <p>
                            En el entorno sandbox (pruebas), Addon Payments proporciona un simulador de Emisor ACS que le permite probar diferentes resultados de desafíos.
                        </p>

                        <p>
                            Una vez que se haya cargado el desafío, después de diez segundos, el simulador completará automáticamente la autenticación y generará una respuesta de Autenticación exitosa (transStatus = “Y”).
                             Esto tiene la intención de imitar un escenario en el que un cliente ha recibido una notificación en su teléfono para autenticarse usando su aplicación bancaria.
                        </p>

                        <p>
                            Para simular una autenticación fallida, hacer clic en el botón "Cancelar" generará una respuesta fallida (transStatus = “N”).
                             En cualquier escenario, el resultado se enviará en el mensaje de respuesta de desafío (CRes) al punto final de notificación de desafío.
                        </p>
                        <div class="col-12 text-center">
                            <img src="../../../../assets/img/3ds2ACS.png" alt="Simulador ACS">
                        </div>

                        <hr>

                        <h5 class="pt-1" id="resultadoDesafio">
                            3.4 Resultado del desafío
                        </h5>

                        <p>
                            Con el cliente en el ACS, pueden ocurrir los siguientes resultados:
                            <ul>
                                <li>La autenticación es exitosa.</li>
                                <li>La autenticación falla y el cliente no tiene otra oportunidad.</li>
                                <li>La autenticación falla y el cliente tiene otra oportunidad.</li>
                            </ul>
                        </p>

                        <p>
                            Si el cliente ha completado con éxito el desafío y se ha autenticado, Addon Payments procederá a la autorización e incluirá los datos de autenticación de 3D Secure.
                             Alternativamente, en un escenario de transacción bloqueada, HPP devolverá un mensaje de respuesta de fallo (110).
                        </p>

                        <p>
                            En este punto, tanto en escenarios sin fricciones como en escenarios de desafío,
                             la transacción puede autorizarse o declinarse de manera normal en función de si el cliente tiene fondos suficientes en su cuenta o si ingresó su código de seguridad correctamente, etc.
                              Addon Payments devolverá la respuesta de la transacción junto con los datos de autenticación de 3D Secure adicionales que puede capturar en su sitio web/aplicación.
                        </p>

                    </div>   
                </div>
                
              </div>
              <!-- /Contenido común -->

            </div>
          </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="../../../../assets/js/barraprogreso.js"></script>

  </body>
</html>
